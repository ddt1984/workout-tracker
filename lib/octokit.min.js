// Octokit wrapper using GitHub REST API directly
// This is a minimal implementation without external dependencies

window.Octokit = {
    Octokit: class {
        constructor(options = {}) {
            this.auth = options.auth;
            this.baseUrl = 'https://api.github.com';

            this.rest = {
                users: {
                    getAuthenticated: () => this._request('GET', '/user')
                },
                repos: {
                    listForAuthenticatedUser: (params) => {
                        const query = new URLSearchParams({
                            sort: params.sort || 'updated',
                            per_page: params.per_page || 30
                        });
                        return this._request('GET', `/user/repos?${query}`);
                    },
                    getContent: (params) => {
                        return this._request('GET', `/repos/${params.owner}/${params.repo}/contents/${params.path}`);
                    },
                    createOrUpdateFileContents: (params) => {
                        return this._request('PUT', `/repos/${params.owner}/${params.repo}/contents/${params.path}`, {
                            message: params.message,
                            content: params.content,
                            sha: params.sha
                        });
                    }
                }
            };
        }

        async _request(method, path, body = null) {
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            };

            if (this.auth) {
                headers['Authorization'] = `Bearer ${this.auth}`;
            }

            const options = {
                method,
                headers
            };

            if (body) {
                options.body = JSON.stringify(body);
            }

            const response = await fetch(this.baseUrl + path, options);

            if (!response.ok) {
                const error = new Error(`GitHub API error: ${response.status} ${response.statusText}`);
                error.status = response.status;
                throw error;
            }

            const data = await response.json();
            return { data };
        }
    }
};
